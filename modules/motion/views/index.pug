//- index.pug
extends ../../pages/views/page.pug

append head
  link(rel='stylesheet', href='/css/'+ moduleName + '/layout.css')

append breadcrumbs
  if locals.image
    li.header-breadcrumb
      .header-breadcrumb-label #{__('Image')}: #{image}
  if locals.video
    li.header-breadcrumb
      .header-breadcrumb-label #{__('Video')}: #{video}

mixin button(msg, enabled, label)
  a.button.motion-button&attributes({ 'data-emit': msg, 'data-enabled': enabled }) #{label}

block content
  div#motion.motion

    #head
      #header-wrapper.flex-wrapper
        h1#headline.headline.flex-block.flex-left Motion
        #motion-status-container.flex-block.flex-center.motion-status-container&attributes({ 'data-status': 'isRunning' })
          span#button-container.button-container
            a.button.motion-button&attributes({ 'data-emit': 'startMotion', 'data-enabled': '!isRunning' }) &#x1F534;
            a.button.motion-button&attributes({ 'data-emit': 'stopMotion', 'data-enabled': 'isRunning' }) &#x2B1B;
            a.button.motion-button&attributes({ 'data-emit': 'isRunning', 'data-enabled': '{}' }) &#x2753;

    #motion-container.motion-container.flex-wrapper
      #motion-eventList-container.flex-block.flex-left.motion-eventList-container
        h3.eventListHeadline #{__('Event List')}
        table.eventList
          if locals.eventList && Object.keys(eventList).length > 0
            each eventId in Object.keys(eventList).sort()
              - event = eventList[eventId]
              tr.event
                td.date= event.date
                td.time= event.time
                td.take= event.take
                td.image
                  if event.imageLink
                    if !locals.image || event.imageLink.indexOf(image) < 0
                      a.imageLink(href=event.imageLink) &#128247;
                    else
                      strong.imageActive &#128247;
                td.video
                  if event.videoLink
                    if !locals.video || event.videoLink.indexOf(video) < 0
                      a.videoLink(href=event.videoLink) &#127909;
                    else
                      strong.videoActive &#127909;
          else
            tr.event
              td #{__('no events')}
      if locals.image
        #motion-image-container.flex-block.flex-center.motion-image-container
          h2 #{__('Image')}
          .image-container
            img.image(src='/motion/capture/' + image)
      if locals.video
        #motion-video-container.flex-block.flex-center.motion-video-container
          h2 #{__('Video')}
          .video-container
            video.video(controls='controls')
              source(src='/motion/capture/' + video, type='video/mp4')
              | #{__('Your browser can\'t show videos')}

append footer
  script(src='/js/motion/event-handler.js')
  script(src='https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.3/socket.io.js')
  script(src='/js/motion/index.js')
